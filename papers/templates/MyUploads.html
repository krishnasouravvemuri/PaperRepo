{% extends "template.html" %}

{% block title %}PaperRepo | My Uploads{% endblock %}

{% block navbar_right %}
    <a href="{% url 'UploadHome' username %}" class="hover:text-teal-300 cursor-pointer">Home</a>
    <a href="{% url 'MyUploads' username %}" class="hover:text-teal-300 cursor-pointer">My Uploads</a>
    <a href="{% url 'logout' %}" class="hover:text-red-400 cursor-pointer">Logout</a>
{% endblock %}

{% block navbar_right_mobile %}
    <a href="{% url 'UploadHome' username %}" class="block py-2 px-4 hover:text-teal-300">Home</a>
    <a href="{% url 'MyUploads' username %}" class="block py-2 px-4 hover:text-teal-300">My Uploads</a>
    <a href="{% url 'logout' %}" class="block py-2 px-4 hover:text-red-400">Logout</a>
{% endblock %}


{% block content %}
<div class="max-w-6xl mx-auto p-4">

    <!-- Buttons -->
    <div class="flex justify-center gap-4 mb-6">
        <button onclick="showTable('papers')" id="btn-papers" class="px-6 py-2 rounded-md bg-gray-700 hover:bg-teal-400 hover:cursor-pointer transition text-white font-semibold">Question Papers</button>
        <button onclick="showTable('topics')" id="btn-topics" class="px-6 py-2 rounded-md bg-gray-700 hover:bg-teal-400 hover:cursor-pointer transition text-white font-semibold">Important Topics</button>
        <button onclick="showTable('materials')" id="btn-materials" class="px-6 py-2 rounded-md bg-gray-700 hover:bg-teal-400 hover:cursor-pointer transition text-white font-semibold">Study Materials</button>
    </div>

    <!-- Tables -->
    <div>
        <!-- Question Papers Table -->
        <div id="papers" class="upload-table transition-all duration-500 hidden">
            <table class="min-w-full bg-[#1c1530] border border-gray-700 rounded-lg">
                <thead class="bg-[#221c35] text-teal-400">
                    <tr>
                        <th class="px-4 py-2 border-r border-gray-600 text-left">SL No.</th>
                        <th class="px-4 py-2 border-r border-gray-600 text-left">ID</th>
                        <th class="px-4 py-2 border-r border-gray-600 text-left">Title</th>
                        <th class="px-4 py-2 border-r border-gray-600 text-left">Subject</th>
                        <th class="px-4 py-2 border-r border-gray-600 text-left">Code</th>
                        <th class="px-4 py-2 border-r border-gray-600 text-left">Slot</th>
                        <th class="px-4 py-2 border-r border-gray-600 text-left">Exam Type</th>
                        <th class="px-4 py-2 border-r border-gray-600 text-left">Semester</th>
                        <th class="px-4 py-2 border-r border-gray-600 text-left">Exam Year</th>
                        <th class="px-4 py-2 border-gray-600">Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for i in question_papers %}
                    <tr class="border-b border-gray-700 hover:bg-[#2a2235]">
                        <td class="px-4 py-2 border-r border-gray-600">{{ forloop.counter }}</td>
                        <td class="px-4 py-2 border-r border-gray-600">{{ i.pk }}</td>
                        <td class="px-4 py-2 border-r border-gray-600">{{ i.question_paper_title }}</td>
                        <td class="px-4 py-2 border-r border-gray-600">{{ i.subject_name }}</td>
                        <td class="px-4 py-2 border-r border-gray-600">{{ i.subject_code }}</td>
                        <td class="px-4 py-2 border-r border-gray-600">{{ i.exam_slot }}</td>
                        <td class="px-4 py-2 border-r border-gray-600">{{ i.exam_type }}</td>
                        <td class="px-4 py-2 border-r border-gray-600">{{ i.semester }}</td>
                        <td class="px-4 py-2 border-r border-gray-600">{{ i.year }}</td>
                        <td class="px-4 py-2 flex gap-2 justify-center">
                            <a href="{% url 'EditQuestionPapers' i.pk %}" class="px-2 py-1 bg-green-500 rounded text-white hover:bg-green-400">Edit</a>
                            <a href="{% url 'serve_question_paper' username=username paper_id=i.question_paper_id %}" class="px-2 py-1 bg-blue-500 rounded text-white hover:bg-blue-400">View</a>
                            <a href="{% url 'DeleteQuestionPapers' username=username pk=i.pk %}" class="px-2 py-1 bg-red-500 cursor-pointer rounded text-white hover:bg-red-600">Delete</a>
                        </td>
                    </tr>
                    {% empty %}
                    <tr><td colspan="8" class="text-center py-4 border-t border-gray-600">No question papers uploaded.</td></tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>

        <!-- Important Topics Table -->
        <div id="topics" class="upload-table transition-all duration-500 hidden">
            <table class="min-w-full bg-[#1c1530] border border-gray-700 rounded-md">
                <thead class="bg-[#221c35] text-teal-400">
                    <tr>
                        <th class="px-4 py-2 border-r border-gray-600 text-left">SL No.</th>
                        <th class="px-4 py-2 border-r border-gray-600 text-left">ID</th>
                        <th class="px-4 py-2 border-r border-gray-600 text-left">Title</th>
                        <th class="px-4 py-2 border-r border-gray-600 text-left">Subject</th>
                        <th class="px-4 py-2 border-r border-gray-600 text-left">Code</th>
                        <th class="px-4 py-2 border-r border-gray-600 text-left">Exam Type</th>
                        <th class="px-4 py-2 border-r border-gray-600 text-left">Faculty</th>
                        <th class="px-4 py-2 border-gray-600">Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for i in important_topics %}
                    <tr class="border-b border-gray-700 hover:bg-[#2a2235]">
                        <td class="px-4 py-2 border-r border-gray-600">{{ forloop.counter }}</td>
                        <td class="px-4 py-2 border-r border-gray-600">{{ i.pk }}</td>
                        <td class="px-4 py-2 border-r border-gray-600">{{ i.important_topic_title }}</td>
                        <td class="px-4 py-2 border-r border-gray-600">{{ i.subject_name }}</td>
                        <td class="px-4 py-2 border-r border-gray-600">{{ i.subject_code }}</td>
                        <td class="px-4 py-2 border-r border-gray-600">{{ i.exam_type }}</td>
                        <td class="px-4 py-2 border-r border-gray-600">{{ i.faculty_name }}</td>
                        <td class="px-4 py-2 flex gap-2 justify-center">
                            <a href="{% url 'EditImportantTopics' i.pk %}" class="px-2 py-1 bg-green-500 rounded text-white hover:bg-green-400">Edit</a>
                            <a href="{% url 'serve_important_topic' username=username topic_id=i.important_topic_id %}" class="px-2 py-1 bg-blue-500 rounded text-white hover:bg-blue-400">View</a>
                            <a href="{% url 'DeleteImportantTopics' username=username pk=i.pk %}" class="px-2 py-1 bg-red-500 cursor-pointer rounded text-white hover:bg-red-600">Delete</a>
                        </td>
                    </tr>
                    {% empty %}
                    <tr><td colspan="7" class="text-center py-4 border-t border-gray-600">No important topics uploaded.</td></tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>

        <!-- Study Materials Table -->
        <div id="materials" class="upload-table transition-all duration-500 hidden">
            <table class="min-w-full bg-[#1c1530] border border-gray-700 rounded-md">
                <thead class="bg-[#221c35] text-teal-400">
                    <tr>
                        <th class="px-4 py-2 border-r border-gray-600 text-left">SL No.</th>
                        <th class="px-4 py-2 border-r border-gray-600 text-left">ID</th>
                        <th class="px-4 py-2 border-r border-gray-600 text-left">Title</th>
                        <th class="px-4 py-2 border-r border-gray-600 text-left">Subject</th>
                        <th class="px-4 py-2 border-r border-gray-600 text-left">Code</th>
                        <th class="px-4 py-2 border-r border-gray-600 text-left">Topic/Module</th>
                        <th class="px-4 py-2 border-r border-gray-600 text-left">Faculty</th>
                        <th class="px-4 py-2 border-gray-600">Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for i in materials %}
                    <tr class="border-b border-gray-700 hover:bg-[#2a2235]">
                        <td class="px-4 py-2 border-r border-gray-600">{{ forloop.counter }}</td>
                        <td class="px-4 py-2 border-r border-gray-600">{{ i.pk }}</td>
                        <td class="px-4 py-2 border-r border-gray-600">{{ i.study_material_title }}</td>
                        <td class="px-4 py-2 border-r border-gray-600">{{ i.subject_name }}</td>
                        <td class="px-4 py-2 border-r border-gray-600">{{ i.subject_code }}</td>
                        <td class="px-4 py-2 border-r border-gray-600">{{ i.topic_type }}</td>
                        <td class="px-4 py-2 border-r border-gray-600">{{ i.faculty_name }}</td>
                        <td class="px-4 py-2 flex gap-2 justify-center">
                            <a href="{% url 'EditStudyMaterials' i.pk %}" class="px-2 py-1 bg-green-500 rounded text-white hover:bg-green-400">Edit</a>
                            <a href="{% url 'serve_material' username=username material_id=i.material_id %}" class="px-2 py-1 bg-blue-500 rounded text-white hover:bg-blue-400">View</a>
                            <a href="{% url 'DeleteStudyMaterials' username=username pk=i.pk %}" class="px-2 py-1 bg-red-500 cursor-pointer rounded text-white hover:bg-red-600">Delete</a>
                        </td>
                    </tr>
                    {% empty %}
                    <tr><td colspan="7" class="text-center py-4 border-t border-gray-600">No materials uploaded.</td></tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>

<script>
function showTable(tab) {
    const tables = ['papers', 'topics', 'materials'];
    tables.forEach(t => {
        document.getElementById(t).classList.add('hidden');
        document.getElementById('btn-' + t).classList.remove('bg-teal-500');
        document.getElementById('btn-' + t).classList.add('bg-gray-700');
    });

    document.getElementById(tab).classList.remove('hidden');
    document.getElementById('btn-' + tab).classList.add('bg-teal-500');
    document.getElementById('btn-' + tab).classList.remove('bg-gray-700');

    localStorage.setItem('activeUploadTab', tab);
}

document.addEventListener('DOMContentLoaded', () => {
    const activeTab = localStorage.getItem('activeUploadTab') || 'papers';
    showTable(activeTab);
});
</script>
{% endblock %}
